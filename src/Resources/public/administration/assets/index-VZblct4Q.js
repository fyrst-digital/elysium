const a=`<div class="blur-elysium-cms-section-wrapper" @dragover.prevent ref="elysiumSectionWrapper" v-droppable="{ dragGroup: 'cms-stage' }"> <blur-elysium-cms-section-add-block v-if="section.blocks.length === 0" :key="0" @click="onAddBlock" v-droppable="{ dragGroup: 'cms-stage', data: getDropData(0), onDrop: block => dropBlock(block, 0) }" /> <div class="blur-elysium-section-grid" :style="gridStyle" v-if="section.blocks.length > 0" ref="elysiumSectionGrid" @dragover.prevent @drop="onGridDrop"> <template v-for="(block, index) in section.blocks" :key="block.id"> <sw-cms-block ref="elysiumStageBlock" :class="['sw-cms-stage-block', 'blur-elysium-section-block']" :block="block" :disabled="disabled" :active="cmsPage.selectedBlock !== null && cmsPage.selectedBlock.id === block.id" :has-errors="hasBlockErrors(block)" :style="setBlockStyles(block)" v-droppable="{ dragGroup: 'cms-stage', data: getDropData(index + 1), onDrop: block => dropBlock(block, index + 1) }" @block-overlay-click="onBlockSelection(block)"> <div class="blur-elysium-section-block-dropper"> <mt-icon name="regular-plus-circle" /> Zum anf√ºgen hier platzieren </div> <div class="blur-elysium-section-block-resizer" draggable="true" @click="test" @dragstart="$event => startBlockResizeX($event, block, index)" @dragend="endBlockResizeX" @drag="dragBlockResizingX" /> <component :is="\`sw-cms-block-\${block.type}\`" :block="block"> <template v-for="el in block.slots" :key="el.id" #[el.slot] > <sw-cms-slot :element="el" :active="cmsPage.selectedBlock !== null && cmsPage.selectedBlock.id === block.id" /> </template> </component> </sw-cms-block> </template> </div> </div>`,{Utils:g}=Shopware;function c(e){return g.object.deepMergeObject(structuredClone(u),e)}const u={colStart:null,colEnd:12,rowStart:null,rowEnd:null,order:null},i={viewports:{mobile:c(),tablet:c({colEnd:6}),desktop:c({colEnd:6})}},{Component:m,Store:k,Mixin:r}=Shopware,p=m.wrapComponentConfig({template:a,props:["section"],inject:["cmsService"],mixins:[r.getByName("cms-state"),r.getByName("blur-device-utilities")],data(){return{draggedBlock:null,draggedBlockStartPosX:0,draggedBlockWidth:0}},watch:{"section.blocks.length":{handler(){this.section.blocks.map(e=>{e.customFields===null?e.customFields={elysiumBlockSettings:structuredClone(i)}:e.customFields.hasOwnProperty("elysiumBlockSettings")||(e.customFields.elysiumBlockSettings=structuredClone(i))})}}},computed:{cmsPage(){return k.get("cmsPage")},device(){return this.cmsPage.currentCmsDeviceView==="tablet-landscape"?"tablet":this.cmsPage.currentCmsDeviceView},gridStyle(){return{display:"grid",gridTemplateColumns:"repeat(12, minmax(0, 1fr))",gap:`${this.viewportsPlaceholder("gridGap",20)}px`,paddingBlock:`${this.viewportsPlaceholder("paddingY",0)}px`,paddingInline:`${this.viewportsPlaceholder("paddingY",0)}px`,alignItems:this.viewportsPlaceholder("alignItems","stretch")}}},methods:{getDropData(e,t="main"){return{dropIndex:e,section:this.section,sectionPosition:t}},dropBlock(e,t){this.section.blocks[t].hasOwnProperty("customFields")?this.section.blocks[t].customFields.elysiumBlockSettings=structuredClone(i):this.section.blocks[t].customFields={elysiumBlockSettings:structuredClone(i)}},setBlockStyles(e){var o,l;const t={},s=(l=(o=e.customFields)==null?void 0:o.elysiumBlockSettings)==null?void 0:l.viewports;return s&&(t["--blur-elysium-section-block-col-start"]=this.viewportsPlaceholder("colStart","auto",null,s),t["--blur-elysium-section-block-col-end"]=this.viewportsPlaceholder("colEnd",12,null,s),t["--blur-elysium-section-block-row-start"]=this.viewportsPlaceholder("rowStart","auto",null,s),t["--blur-elysium-section-block-row-end"]=this.viewportsPlaceholder("rowEnd","auto",null,s),t["--blur-elysium-section-block-order"]=this.viewportsPlaceholder("order",999,null,s)),t},hasBlockErrors(e){return[this.hasUniqueBlockErrors(e),this.hasSlotConfigErrors(e)].some(t=>!!t)},hasUniqueBlockErrors(e){var s,o;const t=(o=(s=this.pageSlotsError)==null?void 0:s.parameters)==null?void 0:o.elements;return t?t.some(l=>l.blockIds.includes(e.id)):!1},hasSlotConfigErrors(e){var s,o;const t=(o=(s=this.pageSlotConfigError)==null?void 0:s.parameters)==null?void 0:o.elements;return t?t.some(l=>l.blockId===e.id):!1},onBlockSelection(e){this.cmsPage.setBlock(e),this.$emit("on-select-block",e)},onGridDrop(e){this.draggedBlock.customFields.elysiumBlockSettings.viewports[this.device].colEnd=this.calculateDraggedBlockColWidth(e.x)},startBlockResizeX(e,t){this.draggedBlock=t,this.draggedBlockStartPosX=e.x,this.draggedBlockWidth=e.target.offsetParent.offsetWidth;const s=new Image;s.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",e.dataTransfer.setDragImage(s,0,0)},dragBlockResizingX(e){this.calculateDraggedBlockColWidth(e.x)>0&&this.calculateDraggedBlockColWidth(e.x)<=12&&(this.draggedBlock.customFields.elysiumBlockSettings.viewports[this.device].colEnd=this.calculateDraggedBlockColWidth(e.x))},endBlockResizeX(e){this.calculateDraggedBlockColWidth(e.x)>=12&&(this.draggedBlock.customFields.elysiumBlockSettings.viewports[this.device].colEnd=12)},calculateDraggedBlockColWidth(e){const t=this.draggedBlockWidth,s=this.draggedBlockStartPosX,l=e-s,d=window.getComputedStyle(this.$refs.elysiumSectionGrid),n=this.$refs.elysiumSectionGrid.offsetWidth-parseFloat(d.getPropertyValue("padding-inline"))*2;return Math.round((t+l)/(n/12))},onAddBlock(){this.$emit("on-add-block")}},created(){var e,t;this.viewportsSettings=(t=(e=this.section.customFields)==null?void 0:e.elysiumSectionSettings)==null?void 0:t.viewports}});export{p as default};
//# sourceMappingURL=index-VZblct4Q.js.map
