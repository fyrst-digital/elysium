{"version":3,"file":"index-VZblct4Q.js","sources":["../../../app/administration/src/component/cms/section/template.html.twig","../../../app/administration/src/component/cms/section/config.ts","../../../app/administration/src/component/cms/section/index.ts"],"sourcesContent":["<div class=\"blur-elysium-cms-section-wrapper\"\n    @dragover.prevent\n    ref=\"elysiumSectionWrapper\"\n    v-droppable=\"{ dragGroup: 'cms-stage' }\">\n\n    <blur-elysium-cms-section-add-block \n        v-if=\"section.blocks.length === 0\"\n        :key=\"0\"\n        @click=\"onAddBlock\"\n        v-droppable=\"{ dragGroup: 'cms-stage', data: getDropData(0), onDrop: block => dropBlock(block, 0) }\" />\n\n    <div \n        class=\"blur-elysium-section-grid\"\n        :style=\"gridStyle\"\n        v-if=\"section.blocks.length > 0\"\n        ref=\"elysiumSectionGrid\"\n        @dragover.prevent \n        @drop=\"onGridDrop\">\n\n        <template\n            v-for=\"(block, index) in section.blocks\"\n            :key=\"block.id\">\n            \n            <sw-cms-block\n                ref=\"elysiumStageBlock\"\n                :class=\"['sw-cms-stage-block', 'blur-elysium-section-block']\"\n                :block=\"block\"\n                :disabled=\"disabled\"\n                :active=\"cmsPage.selectedBlock !== null && cmsPage.selectedBlock.id === block.id\"\n                :has-errors=\"hasBlockErrors(block)\"\n                :style=\"setBlockStyles(block)\"\n                v-droppable=\"{ dragGroup: 'cms-stage', data: getDropData(index + 1), onDrop: block => dropBlock(block, index + 1) }\"\n                @block-overlay-click=\"onBlockSelection(block)\">\n            \n                <div class=\"blur-elysium-section-block-dropper\">\n                    <mt-icon name=\"regular-plus-circle\" />\n                    Zum anf√ºgen hier platzieren\n                </div>\n\n                <div class=\"blur-elysium-section-block-resizer\" \n                    draggable=\"true\" \n                    @click=\"test\"\n                    @dragstart=\"$event => startBlockResizeX($event, block, index)\"\n                    @dragend=\"endBlockResizeX\"\n                    @drag=\"dragBlockResizingX\" />\n\n                <component\n                    :is=\"`sw-cms-block-${block.type}`\"\n                    :block=\"block\">\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    <template\n                        v-for=\"el in block.slots\"\n                        :key=\"el.id\"\n                        #[el.slot]\n                    >\n                        <sw-cms-slot\n                            :element=\"el\"\n                            :active=\"cmsPage.selectedBlock !== null && cmsPage.selectedBlock.id === block.id\"\n                        />\n                    </template>\n\n                </component>\n\n            </sw-cms-block>\n\n        </template>\n\n    </div>\n</div>","const { Utils } = Shopware\n\nexport interface BlockViewportSettings {\n    colStart: number | null | 'auto'\n    colEnd: number | null | 'auto'\n    rowStart: number | null | 'auto'\n    rowEnd: number | null | 'auto'\n    order: number | null\n}\n\nfunction defineViewportSettings(overrides?: Partial<BlockViewportSettings>): BlockViewportSettings {\n    return Utils.object.deepMergeObject(structuredClone(blockViewportSettings), overrides)\n}\n\nconst blockViewportSettings: BlockViewportSettings = {\n    colStart: null,\n    colEnd: 12,\n    rowStart: null,\n    rowEnd: null,\n    order: null\n}\n\nexport const blockSettings = {\n    viewports: {\n        mobile: defineViewportSettings(),\n        tablet: defineViewportSettings({\n            colEnd: 6\n        }),\n        desktop: defineViewportSettings({\n            colEnd: 6\n        })\n    }\n}","import template from './template.html.twig'\nimport { blockSettings } from './config'\nimport './style.scss'\n\nconst { Component, Store, Mixin } = Shopware\n\nexport default Component.wrapComponentConfig({\n    template,\n\n    props: ['section'],\n\n    inject: [\n        'cmsService',\n    ],\n\n    mixins: [\n        Mixin.getByName('cms-state'),\n        Mixin.getByName('blur-device-utilities'),\n    ],\n\n    data () {\n        return {\n            draggedBlock: null,\n            draggedBlockStartPosX: 0,\n            draggedBlockWidth: 0,\n        }\n    },\n\n    watch: {\n    \n        'section.blocks.length': {\n            handler() {\n                /**\n                 * @todo This solution is not optimal, because it iterates over all blocks and can lead to performance issues with a lot of blocks\n                 * Better solution would be to add the setting to the block when it is dropped. \n                 * For now, this is the easiest and lightweight compromise.\n                 */\n                this.section.blocks.map((block) => {\n                    if (block.customFields === null) {\n                        block.customFields = {\n                            elysiumBlockSettings: structuredClone(blockSettings)\n                        }\n                    } else if (!block.customFields.hasOwnProperty('elysiumBlockSettings')) {\n                        block.customFields.elysiumBlockSettings = structuredClone(blockSettings)\n                    }\n                })\n            },\n        },\n    },\n\n    computed: {\n\n        cmsPage () {\n            return Store.get('cmsPage')\n        },\n\n        device () {\n\n            if (this.cmsPage.currentCmsDeviceView === 'tablet-landscape') {\n                return 'tablet'\n            }\n\n            return this.cmsPage.currentCmsDeviceView\n        },\n\n        gridStyle() {\n            const gridStyle: Partial<CSSStyleDeclaration> = {\n                display: 'grid',\n                gridTemplateColumns: 'repeat(12, minmax(0, 1fr))',\n                gap: `${this.viewportsPlaceholder('gridGap', 20)}px`,\n                paddingBlock: `${this.viewportsPlaceholder('paddingY', 0)}px`,\n                paddingInline: `${this.viewportsPlaceholder('paddingY', 0)}px`,\n                alignItems: this.viewportsPlaceholder('alignItems', 'stretch')\n            }\n\n            return gridStyle\n        },\n    },\n\n    methods: {\n\n        getDropData (index, sectionPosition = 'main') {\n            return { dropIndex: index, section: this.section, sectionPosition };\n        },\n        \n        dropBlock (block, index) {\n\n            if (this.section.blocks[index].hasOwnProperty('customFields')) {\n                this.section.blocks[index].customFields.elysiumBlockSettings = structuredClone(blockSettings)    \n            } else {\n                this.section.blocks[index].customFields = {\n                    elysiumBlockSettings: structuredClone(blockSettings)\n                }\n            }\n        },\n\n        setBlockStyles (block) {\n            const styles: Partial<CSSStyleDeclaration> = {}\n            const viewportsSettings = block.customFields?.elysiumBlockSettings?.viewports\n\n            if (viewportsSettings) {\n                styles['--blur-elysium-section-block-col-start'] = this.viewportsPlaceholder('colStart', 'auto', null, viewportsSettings)\n                styles['--blur-elysium-section-block-col-end'] = this.viewportsPlaceholder('colEnd', 12, null, viewportsSettings)\n                styles['--blur-elysium-section-block-row-start'] = this.viewportsPlaceholder('rowStart', 'auto', null, viewportsSettings)\n                styles['--blur-elysium-section-block-row-end'] = this.viewportsPlaceholder('rowEnd', 'auto', null, viewportsSettings)\n                styles['--blur-elysium-section-block-order'] = this.viewportsPlaceholder('order', 999, null, viewportsSettings)\n            }\n\n            return styles;\n        },\n\n        hasBlockErrors (block) {\n            return [\n                this.hasUniqueBlockErrors(block),\n                this.hasSlotConfigErrors(block),\n            ].some(error => !!error);\n        },\n\n        hasUniqueBlockErrors (block) {\n            const errorElements = this.pageSlotsError?.parameters?.elements;\n\n            if (!errorElements) {\n                return false;\n            }\n\n            return errorElements.some(errorType => errorType.blockIds.includes(block.id));\n        },\n\n        hasSlotConfigErrors (block) {\n            const errorElements = this.pageSlotConfigError?.parameters?.elements;\n\n            if (!errorElements) {\n                return false;\n            }\n\n            return errorElements.some(missingConfig => missingConfig.blockId === block.id);\n        },\n\n        onBlockSelection (block) {\n            this.cmsPage.setBlock(block);\n            this.$emit('on-select-block', block);\n        },\n\n        onGridDrop (event) {\n            this.draggedBlock.customFields.elysiumBlockSettings.viewports[this.device].colEnd = this.calculateDraggedBlockColWidth(event.x)\n        },\n\n        startBlockResizeX (event, block) {\n            this.draggedBlock = block\n            this.draggedBlockStartPosX = event.x\n            this.draggedBlockWidth = event.target.offsetParent.offsetWidth\n            const img = new Image()\n            img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'\n            event.dataTransfer.setDragImage(img, 0, 0)\n        },\n\n        dragBlockResizingX (event) {\n            if ((this.calculateDraggedBlockColWidth(event.x) > 0) && (this.calculateDraggedBlockColWidth(event.x) <= 12)) {\n                this.draggedBlock.customFields.elysiumBlockSettings.viewports[this.device].colEnd = this.calculateDraggedBlockColWidth(event.x)\n            }\n        },\n\n        endBlockResizeX (event) {\n            if (this.calculateDraggedBlockColWidth(event.x) >= 12) {\n                this.draggedBlock.customFields.elysiumBlockSettings.viewports[this.device].colEnd = 12\n            }\n        },\n\n        calculateDraggedBlockColWidth (currentX) {\n            const blockWidth = this.draggedBlockWidth\n            const startX = this.draggedBlockStartPosX\n            const endX = currentX\n            const movedPx = endX - startX\n            const computedStyles = window.getComputedStyle(this.$refs.elysiumSectionGrid)\n            const gridWidth = this.$refs.elysiumSectionGrid.offsetWidth - (parseFloat(computedStyles.getPropertyValue('padding-inline')) * 2)\n\n            return Math.round((blockWidth + movedPx) / (gridWidth / 12))\n        },\n\n        onAddBlock () {\n            this.$emit('on-add-block')\n        },\n    },\n\n    created () {\n        this.viewportsSettings = this.section.customFields?.elysiumSectionSettings?.viewports\n    }\n})"],"names":["template","Utils","defineViewportSettings","overrides","blockViewportSettings","blockSettings","Component","Store","Mixin","index","block","sectionPosition","_a","_b","styles","viewportsSettings","error","errorElements","errorType","missingConfig","event","img","currentX","blockWidth","startX","movedPx","computedStyles","gridWidth"],"mappings":"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"}