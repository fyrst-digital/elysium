{"version":3,"file":"index-InfeJm3Z.js","sources":["../../../../../../../../custom/static-plugins/BlurElysiumSlider/src/Resources/app/administration/src/component/cms/section/template.html.twig","../../../../../../../../custom/static-plugins/BlurElysiumSlider/src/Resources/app/administration/src/component/cms/section/config.ts","../../../../../../../../custom/static-plugins/BlurElysiumSlider/src/Resources/app/administration/src/component/cms/section/index.ts"],"sourcesContent":["<div\n    class=\"blur-elysium-cms-section-wrapper\"\n    @dragover.prevent\n    ref=\"elysiumSectionWrapper\"\n    v-droppable=\"{ dragGroup: 'cms-stage' }\"\n>\n    <blur-elysium-cms-section-add-block\n        v-if=\"section.blocks.length === 0\"\n        :key=\"0\"\n        @click=\"onAddBlock\"\n        v-droppable=\"{ dragGroup: 'cms-stage', data: getDropData(0), onDrop: block => dropBlock(block, 0) }\"\n    />\n    <div\n        class=\"blur-elysium-section-grid\"\n        :style=\"gridStyle\"\n        v-if=\"section.blocks.length > 0\"\n        ref=\"elysiumSectionGrid\"\n        @dragover.prevent\n        @drop=\"onGridDrop\"\n    >\n        <template\n            v-for=\"(block, index) in section.blocks\"\n            :key=\"block.id\"\n        >\n            <sw-cms-block\n                ref=\"elysiumStageBlock\"\n                :class=\"['sw-cms-stage-block', 'blur-elysium-section-block']\"\n                :block=\"block\"\n                :disabled=\"disabled\"\n                :active=\"cmsPage.selectedBlock !== null && cmsPage.selectedBlock.id === block.id\"\n                :has-errors=\"hasBlockErrors(block)\"\n                :style=\"setBlockStyles(block)\"\n                v-droppable=\"{ dragGroup: 'cms-stage', data: getDropData(index + 1), onDrop: block => dropBlock(block, index + 1) }\"\n                @block-overlay-click=\"onBlockSelection(block)\"\n            >\n                <div class=\"blur-elysium-section-block-dropper\">\n                    <mt-icon name=\"regular-plus-circle\"/>\n                    Zum anf√ºgen hier platzieren\n                </div>\n                <div\n                    class=\"blur-elysium-section-block-resizer\"\n                    draggable=\"true\"\n                    @click=\"test\"\n                    @dragstart=\"$event => startBlockResizeX($event, block, index)\"\n                    @dragend=\"endBlockResizeX\"\n                    @drag=\"dragBlockResizingX\"\n                />\n                <component\n                    :is=\"`sw-cms-block-${block.type}`\"\n                    :block=\"block\"\n                >\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    <template\n                        v-for=\"el in block.slots\"\n                        :key=\"el.id\"\n                        #[el.slot]\n                    >\n                        <sw-cms-slot\n                            :element=\"el\"\n                            :active=\"cmsPage.selectedBlock !== null && cmsPage.selectedBlock.id === block.id\"\n                        />\n                    </template>\n                </component>\n            </sw-cms-block>\n        </template>\n    </div>\n</div>","const { Utils } = Shopware;\n\nexport interface BlockViewportSettings {\n    colStart: number | null | 'auto';\n    colEnd: number | null | 'auto';\n    rowStart: number | null | 'auto';\n    rowEnd: number | null | 'auto';\n    order: number | null;\n}\n\nfunction defineViewportSettings(\n    overrides?: Partial<BlockViewportSettings>\n): BlockViewportSettings {\n    return Utils.object.deepMergeObject(\n        structuredClone(blockViewportSettings),\n        overrides\n    );\n}\n\nconst blockViewportSettings: BlockViewportSettings = {\n    colStart: null,\n    colEnd: 12,\n    rowStart: null,\n    rowEnd: null,\n    order: null,\n};\n\nexport const blockSettings = {\n    viewports: {\n        mobile: defineViewportSettings(),\n        tablet: defineViewportSettings({\n            colEnd: 6,\n        }),\n        desktop: defineViewportSettings({\n            colEnd: 6,\n        }),\n    },\n};\n","import template from './template.html.twig';\nimport { blockSettings } from './config';\nimport './style.scss';\n\nconst { Component, Store, Mixin } = Shopware;\n\nexport default Component.wrapComponentConfig({\n    template,\n\n    props: ['section'],\n\n    inject: ['cmsService'],\n\n    mixins: [\n        Mixin.getByName('cms-state'),\n        Mixin.getByName('blur-device-utilities'),\n    ],\n\n    data() {\n        return {\n            draggedBlock: null,\n            draggedBlockStartPosX: 0,\n            draggedBlockWidth: 0,\n        };\n    },\n\n    watch: {\n        'section.blocks.length': {\n            handler() {\n                /**\n                 * @todo This solution is not optimal, because it iterates over all blocks and can lead to performance issues with a lot of blocks\n                 * Better solution would be to add the setting to the block when it is dropped.\n                 * For now, this is the easiest and lightweight compromise.\n                 */\n                this.section.blocks.map((block) => {\n                    if (block.customFields === null) {\n                        block.customFields = {\n                            elysiumBlockSettings:\n                                structuredClone(blockSettings),\n                        };\n                    } else if (\n                        !block.customFields.hasOwnProperty(\n                            'elysiumBlockSettings'\n                        )\n                    ) {\n                        block.customFields.elysiumBlockSettings =\n                            structuredClone(blockSettings);\n                    }\n                });\n            },\n        },\n    },\n\n    computed: {\n        cmsPage() {\n            return Store.get('cmsPage');\n        },\n\n        device() {\n            if (this.cmsPage.currentCmsDeviceView === 'tablet-landscape') {\n                return 'tablet';\n            }\n\n            return this.cmsPage.currentCmsDeviceView;\n        },\n\n        gridStyle() {\n            const gridStyle: Partial<CSSStyleDeclaration> = {\n                display: 'grid',\n                gridTemplateColumns: 'repeat(12, minmax(0, 1fr))',\n                gap: `${this.viewportsPlaceholder('gridGap', 20)}px`,\n                paddingBlock: `${this.viewportsPlaceholder('paddingY', 0)}px`,\n                paddingInline: `${this.viewportsPlaceholder('paddingY', 0)}px`,\n                alignItems: this.viewportsPlaceholder('alignItems', 'stretch'),\n            };\n\n            return gridStyle;\n        },\n    },\n\n    methods: {\n        getDropData(index, sectionPosition = 'main') {\n            return { dropIndex: index, section: this.section, sectionPosition };\n        },\n\n        dropBlock(block, index) {\n            if (this.section.blocks[index].hasOwnProperty('customFields')) {\n                this.section.blocks[index].customFields.elysiumBlockSettings =\n                    structuredClone(blockSettings);\n            } else {\n                this.section.blocks[index].customFields = {\n                    elysiumBlockSettings: structuredClone(blockSettings),\n                };\n            }\n        },\n\n        setBlockStyles(block) {\n            const styles: Partial<CSSStyleDeclaration> = {};\n            const viewportsSettings =\n                block.customFields?.elysiumBlockSettings?.viewports;\n\n            if (viewportsSettings) {\n                styles['--blur-elysium-section-block-col-start'] =\n                    this.viewportsPlaceholder(\n                        'colStart',\n                        'auto',\n                        null,\n                        viewportsSettings\n                    );\n                styles['--blur-elysium-section-block-col-end'] =\n                    this.viewportsPlaceholder(\n                        'colEnd',\n                        12,\n                        null,\n                        viewportsSettings\n                    );\n                styles['--blur-elysium-section-block-row-start'] =\n                    this.viewportsPlaceholder(\n                        'rowStart',\n                        'auto',\n                        null,\n                        viewportsSettings\n                    );\n                styles['--blur-elysium-section-block-row-end'] =\n                    this.viewportsPlaceholder(\n                        'rowEnd',\n                        'auto',\n                        null,\n                        viewportsSettings\n                    );\n                styles['--blur-elysium-section-block-order'] =\n                    this.viewportsPlaceholder(\n                        'order',\n                        999,\n                        null,\n                        viewportsSettings\n                    );\n            }\n\n            return styles;\n        },\n\n        hasBlockErrors(block) {\n            return [\n                this.hasUniqueBlockErrors(block),\n                this.hasSlotConfigErrors(block),\n            ].some((error) => !!error);\n        },\n\n        hasUniqueBlockErrors(block) {\n            const errorElements = this.pageSlotsError?.parameters?.elements;\n\n            if (!errorElements) {\n                return false;\n            }\n\n            return errorElements.some((errorType) =>\n                errorType.blockIds.includes(block.id)\n            );\n        },\n\n        hasSlotConfigErrors(block) {\n            const errorElements =\n                this.pageSlotConfigError?.parameters?.elements;\n\n            if (!errorElements) {\n                return false;\n            }\n\n            return errorElements.some(\n                (missingConfig) => missingConfig.blockId === block.id\n            );\n        },\n\n        onBlockSelection(block) {\n            this.cmsPage.setBlock(block);\n            this.$emit('on-select-block', block);\n        },\n\n        onGridDrop(event) {\n            this.draggedBlock.customFields.elysiumBlockSettings.viewports[\n                this.device\n            ].colEnd = this.calculateDraggedBlockColWidth(event.x);\n        },\n\n        startBlockResizeX(event, block) {\n            this.draggedBlock = block;\n            this.draggedBlockStartPosX = event.x;\n            this.draggedBlockWidth = event.target.offsetParent.offsetWidth;\n            const img = new Image();\n            img.src =\n                'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n            event.dataTransfer.setDragImage(img, 0, 0);\n        },\n\n        dragBlockResizingX(event) {\n            if (\n                this.calculateDraggedBlockColWidth(event.x) > 0 &&\n                this.calculateDraggedBlockColWidth(event.x) <= 12\n            ) {\n                this.draggedBlock.customFields.elysiumBlockSettings.viewports[\n                    this.device\n                ].colEnd = this.calculateDraggedBlockColWidth(event.x);\n            }\n        },\n\n        endBlockResizeX(event) {\n            if (this.calculateDraggedBlockColWidth(event.x) >= 12) {\n                this.draggedBlock.customFields.elysiumBlockSettings.viewports[\n                    this.device\n                ].colEnd = 12;\n            }\n        },\n\n        calculateDraggedBlockColWidth(currentX) {\n            const blockWidth = this.draggedBlockWidth;\n            const startX = this.draggedBlockStartPosX;\n            const endX = currentX;\n            const movedPx = endX - startX;\n            const computedStyles = window.getComputedStyle(\n                this.$refs.elysiumSectionGrid\n            );\n            const gridWidth =\n                this.$refs.elysiumSectionGrid.offsetWidth -\n                parseFloat(computedStyles.getPropertyValue('padding-inline')) *\n                    2;\n\n            return Math.round((blockWidth + movedPx) / (gridWidth / 12));\n        },\n\n        onAddBlock() {\n            this.$emit('on-add-block');\n        },\n    },\n\n    created() {\n        this.viewportsSettings =\n            this.section.customFields?.elysiumSectionSettings?.viewports;\n    },\n});\n"],"names":["template","Utils","defineViewportSettings","overrides","blockViewportSettings","blockSettings","Component","Store","Mixin","index","block","sectionPosition","_a","_b","styles","viewportsSettings","error","errorElements","errorType","missingConfig","event","img","currentX","blockWidth","startX","movedPx","computedStyles","gridWidth"],"mappings":"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"}